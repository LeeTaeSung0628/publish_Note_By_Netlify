<style>

/* ÌîåÎ°úÌåÖ Î≤ÑÌäº Í≥µÌÜµ Ïä§ÌÉÄÏùº */
#floatingMenuBtn,
#scrollToTopBtn,
#goBackBtn {
    position: fixed;
    width: 60px;
    height: 60px;
    background-color: var(--background-secondary-alt);
    color: var(--text-normal);
    border: 2px solid #404040;
    border-radius: 50%;
    font-size: 30px;
    text-align: center;
    line-height: 60px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.3s ease-in-out, transform 0.2s;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.5);
    z-index: 99999;
}

#floatingMenuBtn:hover,
#scrollToTopBtn:hover,
#goBackBtn:hover {
    background-color: var(--color-accent);
    transform: scale(1.2);
}
</style>

<script>
(function() {
    document.documentElement.classList.add("theme-dark");
    document.documentElement.classList.remove("theme-light");

    function forceDarkTheme() {
        document.body.classList.add("theme-dark");
        document.body.classList.remove("theme-light");

        let themeToggle = document.querySelector(".theme-toggle-input");
        if (themeToggle) {
            themeToggle.checked = true;
            themeToggle.disabled = true;
        }

        let topbar = document.querySelector(".topbar-content");
        if (topbar) {
            topbar.innerHTML = `
                <a class="tree-item-self is-clickable nav-file-title" href="üè†-taesung's-blog.html" data-path="üè†-taesung's-blog.html">
                    <div class="tree-item-inner nav-file-title-content">üè† taesung's Blog</div>
                </a>`;
        }
    }

//-------------

    // Ìä∏Î¶¨Í±∞ / Ìï∏Îì§Îü¨
    function handleResize(entries) {
        for (let entry of entries) {
            updateScrollButtonPosition();
        }
    }

    //Ïä§ÌÅ¨Î°§ ÌéòÏù¥ÏßÄ ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Í∞êÏßÄ
    function observeMarkdownPreviewResize() {
        let container = document.querySelector(".sidebar-right.sidebar");
        if (!container) return;

        // ResizeObserver Ïù∏Ïä§ÌÑ¥Ïä§ ÏÉùÏÑ±
        const resizeObserver = new ResizeObserver(handleResize);
        resizeObserver.observe(container);
    }

    //ÌéòÏù¥ÏßÄ ÌÅ¨Í∏∞ Î≥ÄÍ≤ΩÏãú ÎèôÏ†ÅÏúºÎ°ú ÏúÑÏπò Î≥ÄÍ≤Ω
    function updateScrollButtonPosition() {
        let sidebar = document.querySelector(".sidebar-right.sidebar");
        let menuBtn = document.getElementById("floatingMenuBtn");
        let topBtn = document.getElementById("scrollToTopBtn");
        let backBtn = document.getElementById("goBackBtn");
        if (!sidebar || !menuBtn) return;

        let sidebarRect = sidebar.getBoundingClientRect();
        let buttonWidth = 60; // Î≤ÑÌäº ÎÑàÎπÑ
        let padding = 90; // Ïö∞Ï∏° Ïó¨Î∞±

        let right = `${window.innerWidth - sidebarRect.left - buttonWidth + padding}px`;
        menuBtn.style.right = right;
        if (topBtn) topBtn.style.right = right;
        if (backBtn) backBtn.style.right = right;
    }

    function addFloatingButtons() {
        let container = document.querySelector(".sidebar-right.sidebar");
        if (!container) return;

        let menuBtn = document.getElementById("floatingMenuBtn");
        if (!menuBtn) {
            menuBtn = document.createElement("button");
            menuBtn.id = "floatingMenuBtn";
            menuBtn.innerHTML = "+";
            container.appendChild(menuBtn);
        }

        let topBtn = document.getElementById("scrollToTopBtn");
        if (!topBtn) {
            topBtn = document.createElement("button");
            topBtn.id = "scrollToTopBtn";
            topBtn.innerHTML = "&#9650;";
            container.appendChild(topBtn);
        }

        let backBtn = document.getElementById("goBackBtn");
        if (!backBtn) {
            backBtn = document.createElement("button");
            backBtn.id = "goBackBtn";
            backBtn.innerHTML = "&#8592;";
            container.appendChild(backBtn);
        }

        // Í∏∞Î≥∏ ÏúÑÏπò ÏÑ∏ÌåÖ
        menuBtn.style.position = "fixed";
        menuBtn.style.bottom = "60px";
        menuBtn.style.right = "60px";
        menuBtn.style.opacity = "1";
        menuBtn.style.visibility = "visible";

        [topBtn, backBtn].forEach((btn, idx) => {
            btn.style.position = "fixed";
            btn.style.bottom = `${60 + (idx + 1) * 70}px`;
            btn.style.right = "60px";
            btn.style.zIndex = "99998";
            btn.style.opacity = "0";
            btn.style.visibility = "hidden";
        });

        updateScrollButtonPosition();

        menuBtn.addEventListener("click", function() {
            let visible = topBtn.style.visibility === "visible";
            if (visible) {
                topBtn.style.opacity = "0";
                topBtn.style.visibility = "hidden";
                backBtn.style.opacity = "0";
                backBtn.style.visibility = "hidden";
                menuBtn.innerHTML = "+";
            } else {
                topBtn.style.opacity = "1";
                topBtn.style.visibility = "visible";
                backBtn.style.opacity = "1";
                backBtn.style.visibility = "visible";
                menuBtn.innerHTML = "√ó";
            }
        });

        topBtn.addEventListener("click", function() {
            let scrollContainer = document.querySelector(".markdown-preview-view");
            if(!scrollContainer){
               return;
            }
            scrollContainer.scrollTo({ top: 0, behavior: "smooth" });
        });

        backBtn.addEventListener("click", function() {
            history.back();
        });

        window.addEventListener("resize", updateScrollButtonPosition);
    }

    let setActiveDocument1 = window.setActiveDocument; // Í∏∞Ï°¥ Ìï®Ïàò Ï†ÄÏû•

    window.setActiveDocument = function(...args) {
        if (typeof setActiveDocument1 === "function") {
            setActiveDocument1.apply(this, args); // ÏõêÎûò Ìï®Ïàò Ïã§Ìñâ
            forceDarkTheme();
            addFloatingButtons();
            updateScrollButtonPosition();
            return observeMarkdownPreviewResize();
        }
    };
})();
</script>
